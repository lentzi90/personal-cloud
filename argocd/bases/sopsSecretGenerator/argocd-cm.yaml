apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
data:
  # kustomize.buildOptions: --enable-alpha-plugins
  configManagementPlugins: |
    - name: sops
      ## Optional command to initialize application source directory
      init:
        command: ["/bin/bash", "-c"]
        # TODO: Add passphrase?
        args:
          - gpg --import /gpg-keys/argocd-gpg-private-key.gpg

      ## Command to generate manifests YAML
      generate:
        command: ["/bin/bash", "-c"]
        args:
          - kustomize build --enable-alpha-plugins .;
