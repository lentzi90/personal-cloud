apiVersion: apps/v1
kind: Deployment
metadata:
  name: collabora
spec:
  strategy:
    type: Recreate
  template:
    spec:
      containers:
      - name: collabora
        image: collabora/code
        securityContext:
          capabilities:
            add:
            - MKNOD
        ports:
        - name: http
          containerPort: 9980
          protocol: TCP
        livenessProbe:
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 30
          timeoutSeconds: 10
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 30
          timeoutSeconds: 3
          periodSeconds: 5
        resources:
          requests:
            cpu: 500m
            memory: 300Mi
        volumeMounts:
        - name: tmp
          mountPath: /tmp
        - name: cool
          mountPath: /opt/cool/child-roots
      volumes:
      - name: tmp
        emptyDir: {}
      - name: cool
        emptyDir: {}
