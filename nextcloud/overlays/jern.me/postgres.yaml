apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: nextcloud-database
spec:
  instances: 2
  primaryUpdateStrategy: unsupervised
  bootstrap:
    initdb:
      database: nextcloud
      # owner: nextcloud
      import:
        databases:
        - postgres
        type: microservice
        source:
          externalCluster: kubegres

  externalClusters:
  - name: kubegres
    connectionParameters:
      host: kubegres.kubegres
      user: postgres
      dbname: postgres
    password:
      name: postgres-credentials
      key: POSTGRES_PASSWORD

  storage:
    size: 1Gi
    pvcTemplate:
      selector:
        matchLabels:
          local-storage: nextcloud-postgres
      storageClassName: local-storage
