# OpenCloud OIDC Configuration for Keycloak Integration (KinD environment)
# These settings configure OpenCloud to use Keycloak as the identity provider

# Enable external identity provider (disables built-in IDM/IDP)
PROXY_AUTOPROVISION_ACCOUNTS=true

# Web client configuration
WEB_OIDC_CLIENT_ID=web

# OIDC issuer/authority URL (Keycloak realm URL for KinD)
# OC_OIDC_ISSUER is used by multiple services including web (as authority)
OC_OIDC_ISSUER=https://keycloak.local/realms/openCloud
PROXY_OIDC_ISSUER=https://keycloak.local/realms/openCloud

# User claim mappings
PROXY_USER_OIDC_CLAIM=preferred_username
PROXY_USER_CS3_CLAIM=username

# Role assignment (claims from Keycloak)
PROXY_ROLE_ASSIGNMENT_DRIVER=oidc
PROXY_ROLE_ASSIGNMENT_OIDC_CLAIM=roles

# Role mappings (map Keycloak roles to OpenCloud roles)
PROXY_ROLE_ASSIGNMENT_OIDC_MAPPING='"opencloudAdmin"="admin","opencloudSpaceAdmin"="spaceadmin","opencloudUser"="user","opencloudGuest"="guest"'

# Disable built-in IDM and IDP services when using external IDP
OCIS_EXCLUDE_RUN_SERVICES=idm,idp

# OIDC token validation
PROXY_OIDC_ACCESS_TOKEN_VERIFY_METHOD=jwt
PROXY_OIDC_SKIP_USER_INFO=false

# User ID claim for OpenCloud (must match Keycloak's openclouduuid claim)
PROXY_OIDC_USER_ID_CLAIM=openclouduuid
